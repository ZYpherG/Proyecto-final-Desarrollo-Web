<div class="card">
  <h2>Comunicaciones con Clientes</h2>
  
  <form id="formComunicacion" class="grid-3">
    <div>
      <label for="idCliente">Cliente</label>
      <select id="idCliente" name="idCliente" [(ngModel)]="comunicacion.idCliente" required>
        <option value="">Seleccionar cliente</option>
        <option *ngFor="let cliente of clientes" [value]="cliente.idCliente">
          {{ cliente.persona?.razonSocial || (cliente.persona?.primerNombre + ' ' + cliente.persona?.primerApellido) }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="idUsuario">Usuario</label>
      <select id="idUsuario" name="idUsuario" [(ngModel)]="comunicacion.idUsuario">
        <option value="">Seleccionar usuario</option>
        <option *ngFor="let usuario of usuarios" [value]="usuario.idUsuario">
          {{ usuario.nombreUsuario }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="idOrden">Orden</label>
      <select id="idOrden" name="idOrden" [(ngModel)]="comunicacion.idOrden">
        <option value="">Seleccionar orden</option>
        <option *ngFor="let orden of ordenes" [value]="orden.idOrden">
          {{ orden.numeroOrden }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="tipoComunicacion">Tipo Comunicación</label>
      <select id="tipoComunicacion" name="tipoComunicacion" [(ngModel)]="comunicacion.tipoComunicacion" required>
        <option value="EMAIL">Email</option>
        <option value="LLAMADA">Llamada</option>
        <option value="MENSAJE">Mensaje</option>
        <option value="REUNION">Reunión</option>
        <option value="VIDEO_LLAMADA">Video Llamada</option>
      </select>
    </div>
    
    <div class="grid-span-3">
      <label for="asunto">Asunto</label>
      <input type="text" id="asunto" name="asunto" [(ngModel)]="comunicacion.asunto">
    </div>
    
    <div class="grid-span-3">
      <label for="contenido">Contenido</label>
      <textarea id="contenido" name="contenido" [(ngModel)]="comunicacion.contenido" rows="4"></textarea>
    </div>
    
    <div>
      <label for="archivoAdjunto">Archivo Adjunto</label>
      <input type="text" id="archivoAdjunto" name="archivoAdjunto" [(ngModel)]="comunicacion.archivoAdjunto">
    </div>
    
    <div>
      <label for="rutaArchivo">Ruta Archivo</label>
      <input type="text" id="rutaArchivo" name="rutaArchivo" [(ngModel)]="comunicacion.rutaArchivo">
    </div>
    
    <div>
      <label for="fechaComunicacion">Fecha Comunicación</label>
      <input type="datetime-local" id="fechaComunicacion" name="fechaComunicacion" [(ngModel)]="comunicacion.fechaComunicacion">
    </div>
    
    <div>
      <label for="estadoResuelto">Estado Resuelto</label>
      <select id="estadoResuelto" name="estadoResuelto" [(ngModel)]="comunicacion.estadoResuelto">
        <option value="false">No</option>
        <option value="true">Sí</option>
      </select>
    </div>
    
    <div class="align-end grid-3">
      <button type="button" class="btn-primary" (click)="crearComunicacion()">Guardar</button>
      <button type="button" class="btn-secondary" (click)="Limpiar()">Limpiar</button>
      <button type="button" class="btn-danger" *ngIf="comunicacion.idComunicacion" (click)="Eliminar(comunicacion)">Eliminar</button>
    </div>
  </form>
</div>

<div class="card">
  <h3>Búsqueda</h3>
  <div class="search-section grid-4">
    <div class="form-group">
      <label for="buscarCliente">Buscar por Cliente</label>
      <input type="number" id="buscarCliente" #buscarCliente placeholder="ID Cliente">
    </div>
    <div class="form-group">
      <label for="buscarUsuario">Buscar por Usuario</label>
      <input type="number" id="buscarUsuario" #buscarUsuario placeholder="ID Usuario">
    </div>
    <div class="form-group">
      <label for="buscarOrden">Buscar por Orden</label>
      <input type="number" id="buscarOrden" #buscarOrden placeholder="ID Orden">
    </div>
    <div class="form-group">
      <label for="buscarTipo">Tipo Comunicación</label>
      <select id="buscarTipo" #buscarTipo>
        <option value="">Todos los tipos</option>
        <option value="EMAIL">Email</option>
        <option value="LLAMADA">Llamada</option>
        <option value="MENSAJE">Mensaje</option>
        <option value="REUNION">Reunión</option>
        <option value="VIDEO_LLAMADA">Video Llamada</option>
      </select>
    </div>
    
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarPorCliente(buscarCliente.value)">Buscar Cliente</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarPorUsuario(buscarUsuario.value)">Buscar Usuario</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarPorTipoComunicacion(buscarTipo.value)">Buscar Tipo</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarNoResueltas()">No Resueltas</button>
      <button type="button" class="btn-secondary" (click)="buscarComunicaciones()">Mostrar Todos</button>
    </div>
  </div>
</div>

<div class="card">
  <h3>Lista de Comunicaciones</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Tipo</th>
          <th>Asunto</th>
          <th>Fecha</th>
          <th>Resuelto</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of comunicaciones">
          <td>{{ c.idComunicacion }}</td>
          <td>{{ c.cliente?.persona?.razonSocial || (c.cliente?.persona?.primerNombre + ' ' + c.cliente?.persona?.primerApellido) }}</td>
          <td>
            <span class="badge bg-info">{{ c.tipoComunicacion }}</span>
          </td>
          <td>{{ c.asunto }}</td>
          <td>{{ c.fechaComunicacion | date:'short' }}</td>
          <td>
            <span class="badge" [ngClass]="c.estadoResuelto ? 'bg-success' : 'bg-warning'">
              {{ c.estadoResuelto ? 'Sí' : 'No' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-secondary" (click)="modificar(c)">Editar</button>
              <button class="btn-success" *ngIf="!c.estadoResuelto" (click)="marcarComoResuelta(c)">Marcar Resuelta</button>
              <button class="btn-danger" (click)="Eliminar(c)">Eliminar</button>
            </div>
          </td>
        </tr>
        <tr *ngIf="comunicaciones.length === 0">
          <td colspan="7" style="text-align: center;">No hay comunicaciones registradas</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>