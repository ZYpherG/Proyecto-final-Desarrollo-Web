<div class="card">
  <h2>Inventario</h2>
  
  <form id="formInventario" class="grid-3">
    <div>
      <label for="idCategoria">Categoría</label>
      <select id="idCategoria" name="idCategoria" [(ngModel)]="inventario.idCategoria" required>
        <option value="">Seleccionar categoría</option>
        <option *ngFor="let categoria of categorias" [value]="categoria.idCategoria">
          {{ categoria.nombreCategoria }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="idSucursal">Sucursal</label>
      <select id="idSucursal" name="idSucursal" [(ngModel)]="inventario.idSucursal" required>
        <option value="">Seleccionar sucursal</option>
        <option *ngFor="let sucursal of sucursales" [value]="sucursal.idSucursal">
          {{ sucursal.nombreSucursal }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="idProveedor">Proveedor</label>
      <select id="idProveedor" name="idProveedor" [(ngModel)]="inventario.idProveedor">
        <option value="">Seleccionar proveedor</option>
        <option *ngFor="let proveedor of proveedores" [value]="proveedor.idProveedor">
          {{ proveedor.nombreComercial || proveedor.persona?.razonSocial }}
        </option>
      </select>
    </div>
    
    <div>
      <label for="tipoProducto">Tipo Producto</label>
      <select id="tipoProducto" name="tipoProducto" [(ngModel)]="inventario.tipoProducto" required>
        <option value="MATERIA_PRIMA">Materia Prima</option>
        <option value="PRODUCTO_TERMINADO">Producto Terminado</option>
        <option value="MAQUINARIA">Maquinaria</option>
        <option value="EQUIPO">Equipo</option>
        <option value="VEHICULO">Vehículo</option>
      </select>
    </div>
    
    <div>
      <label for="codigoProducto">Código Producto</label>
      <input type="text" id="codigoProducto" name="codigoProducto" [(ngModel)]="inventario.codigoProducto" required>
    </div>
    
    <div class="grid-span-2">
      <label for="nombreProducto">Nombre Producto</label>
      <input type="text" id="nombreProducto" name="nombreProducto" [(ngModel)]="inventario.nombreProducto" required>
    </div>
    
    <div class="grid-span-3">
      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" name="descripcion" [(ngModel)]="inventario.descripcion" rows="3"></textarea>
    </div>
    
    <div>
      <label for="codigoBarras">Código Barras</label>
      <input type="text" id="codigoBarras" name="codigoBarras" [(ngModel)]="inventario.codigoBarras">
    </div>
    
    <div>
      <label for="numeroParte">Número Parte</label>
      <input type="text" id="numeroParte" name="numeroParte" [(ngModel)]="inventario.numeroParte">
    </div>
    
    <div>
      <label for="unidadMedida">Unidad Medida</label>
      <input type="text" id="unidadMedida" name="unidadMedida" [(ngModel)]="inventario.unidadMedida">
    </div>
    
    <div>
      <label for="existenciaActual">Existencia Actual</label>
      <input type="number" id="existenciaActual" name="existenciaActual" [(ngModel)]="inventario.existenciaActual" step="0.001">
    </div>
    
    <div>
      <label for="existenciaMinima">Existencia Mínima</label>
      <input type="number" id="existenciaMinima" name="existenciaMinima" [(ngModel)]="inventario.existenciaMinima" step="0.001">
    </div>
    
    <div>
      <label for="existenciaMaxima">Existencia Máxima</label>
      <input type="number" id="existenciaMaxima" name="existenciaMaxima" [(ngModel)]="inventario.existenciaMaxima" step="0.001">
    </div>
    
    <div>
      <label for="costoPromedio">Costo Promedio</label>
      <input type="number" id="costoPromedio" name="costoPromedio" [(ngModel)]="inventario.costoPromedio" step="0.01">
    </div>
    
    <div>
      <label for="precioVenta">Precio Venta</label>
      <input type="number" id="precioVenta" name="precioVenta" [(ngModel)]="inventario.precioVenta" step="0.01">
    </div>
    
    <div>
      <label for="lote">Lote</label>
      <input type="text" id="lote" name="lote" [(ngModel)]="inventario.lote">
    </div>
    
    <div>
      <label for="fechaVencimiento">Fecha Vencimiento</label>
      <input type="date" id="fechaVencimiento" name="fechaVencimiento" [(ngModel)]="inventario.fechaVencimiento">
    </div>
    
    <div>
      <label for="ubicacionAlmacen">Ubicación Almacén</label>
      <input type="text" id="ubicacionAlmacen" name="ubicacionAlmacen" [(ngModel)]="inventario.ubicacionAlmacen">
    </div>
    
    <div>
      <label for="activo">Activo</label>
      <select id="activo" name="activo" [(ngModel)]="inventario.activo">
        <option value="true">Sí</option>
        <option value="false">No</option>
      </select>
    </div>
    
    <div class="align-end grid-3">
      <button type="button" class="btn-primary" (click)="crearInventario()">Guardar</button>
      <button type="button" class="btn-secondary" (click)="Limpiar()">Limpiar</button>
      <button type="button" class="btn-danger" *ngIf="inventario.idInventario" (click)="Eliminar(inventario)">Eliminar</button>
    </div>
  </form>
</div>

<div class="card">
  <h3>Búsqueda</h3>
  <div class="search-section grid-4">
    <div class="form-group">
      <label for="buscarCodigo">Buscar por Código</label>
      <input type="text" id="buscarCodigo" #buscarCodigo placeholder="Código producto">
    </div>
    <div class="form-group">
      <label for="buscarCodigoBarras">Buscar por Código Barras</label>
      <input type="text" id="buscarCodigoBarras" #buscarCodigoBarras placeholder="Código barras">
    </div>
    <div class="form-group">
      <label for="buscarCategoria">Buscar por Categoría</label>
      <input type="number" id="buscarCategoria" #buscarCategoria placeholder="ID Categoría">
    </div>
    <div class="form-group">
      <label for="buscarSucursal">Buscar por Sucursal</label>
      <input type="number" id="buscarSucursal" #buscarSucursal placeholder="ID Sucursal">
    </div>
    
    <div class="form-group">
      <label for="buscarTipo">Tipo Producto</label>
      <select id="buscarTipo" #buscarTipo>
        <option value="">Todos los tipos</option>
        <option value="MATERIA_PRIMA">Materia Prima</option>
        <option value="PRODUCTO_TERMINADO">Producto Terminado</option>
        <option value="MAQUINARIA">Maquinaria</option>
        <option value="EQUIPO">Equipo</option>
        <option value="VEHICULO">Vehículo</option>
      </select>
    </div>
    
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarPorCodigo(buscarCodigo.value)">Buscar Código</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarPorCodigoBarras(buscarCodigoBarras.value)">Buscar Barras</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarStockBajo()">Stock Bajo</button>
    </div>
    <div class="form-group">
      <button type="button" class="btn-secondary" (click)="buscarActivos()">Solo Activos</button>
      <button type="button" class="btn-secondary" (click)="buscarInventarios()">Mostrar Todos</button>
    </div>
  </div>
</div>

<div class="card">
  <h3>Lista de Inventario</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Código</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Sucursal</th>
          <th>Existencia</th>
          <th>Precio Venta</th>
          <th>Margen</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i of inventarios" [class.table-danger]="tieneStockBajo(i)">
          <td>{{ i.idInventario }}</td>
          <td><strong>{{ i.codigoProducto }}</strong></td>
          <td>{{ i.nombreProducto }}</td>
          <td>{{ i.categoria?.nombreCategoria }}</td>
          <td>{{ i.sucursal?.nombreSucursal }}</td>
          <td>
            <span [class.text-danger]="tieneStockBajo(i)">
              {{ i.existenciaActual }}
            </span>
            <small class="text-muted">/{{ i.existenciaMinima }}</small>
          </td>
          <td>{{ i.precioVenta | currency }}</td>
          <td>{{ calcularMargenGanancia(i) | number:'1.2-2' }}%</td>
          <td>
            <span class="badge" [ngClass]="i.activo ? 'bg-success' : 'bg-danger'">
              {{ i.activo ? 'Sí' : 'No' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-secondary" (click)="modificar(i)">Editar</button>
              <button class="btn-danger" (click)="Eliminar(i)">Eliminar</button>
            </div>
          </td>
        </tr>
        <tr *ngIf="inventarios.length === 0">
          <td colspan="10" style="text-align: center;">No hay productos en inventario</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>